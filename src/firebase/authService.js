import {   signInWithEmailAndPassword,   signInWithPopup,   GoogleAuthProvider,   signOut} from "firebase/auth";import { auth } from "./firebase";import { getUserPreferences, saveUserPreferences, saveUserToFirestore } from "./firestoreService";export const loginWithGoogle = async () => {  try {    const provider = new GoogleAuthProvider();    provider.setCustomParameters({      prompt: 'select_account'    });    const result = await signInWithPopup(auth, provider);    const user = result.user;    if (user) {      await saveUserToFirestore(user.uid, {        displayName: user.displayName,        email: user.email,        phoneNumber: user.phoneNumber || '',        photoURL: user.photoURL,        role: 'fuser',         emailVerified: user.emailVerified,        lastLogin: new Date()      });      await saveUserPreferences(user.uid, {        isLoggedIn: true,        lastLogin: new Date()      });    }    return { success: true, user };  } catch (error) {    console.error("Google login error:", error);    let errorMessage = "Đăng nhập bằng Google thất bại. Vui lòng thử lại.";    if (error.code === 'auth/popup-blocked') {      errorMessage = "Popup đăng nhập bị chặn. Vui lòng cho phép popup và thử lại.";    } else if (error.code === 'auth/popup-closed-by-user') {      errorMessage = "Cửa sổ đăng nhập đã đóng. Vui lòng thử lại.";    } else if (error.code === 'auth/cancelled-popup-request') {      errorMessage = "Yêu cầu đăng nhập đã bị hủy. Vui lòng thử lại.";    } else if (error.code === 'auth/internal-error') {      errorMessage = "Có lỗi xảy ra trong quá trình đăng nhập. Vui lòng thử lại sau.";    }    return {       success: false,       error: errorMessage    };  }};export const loginWithEmailPassword = async (email, password) => {  try {    const userCredential = await signInWithEmailAndPassword(auth, email, password);    const user = userCredential.user;    if (user) {      await saveUserPreferences(user.uid, {        isLoggedIn: true,        lastLogin: new Date()      });    }    return { success: true, user };  } catch (error) {    console.error("Email login error:", error);    let errorMessage = "Đăng nhập thất bại. Vui lòng kiểm tra email và mật khẩu.";    if (error.code === 'auth/user-not-found' || error.code === 'auth/wrong-password') {      errorMessage = "Email hoặc mật khẩu không chính xác.";    } else if (error.code === 'auth/too-many-requests') {      errorMessage = "Quá nhiều yêu cầu đăng nhập. Vui lòng thử lại sau.";    }    return {       success: false,       error: errorMessage    };  }};export const logoutWithStatusUpdate = async () => {  try {    const user = auth.currentUser;    if (user) {      await saveUserPreferences(user.uid, {        isLoggedIn: false,        lastLogout: new Date()      });    }    await signOut(auth);    return { success: true };  } catch (error) {    console.error("Logout error:", error);    return {       success: false,       error: error.message || "Có lỗi khi đăng xuất"    };  }};export default {  loginWithGoogle,  loginWithEmailPassword,  logoutWithStatusUpdate};